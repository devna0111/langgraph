# Langraphë¥¼ í™œìš©í•œ AI Agentë¥¼ ì„¤ê³„í•˜ê¸°
## ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ê²€
- **LLM ì—°ê²°**
   ```
   from langchain_ollama import ChatOllama  # Ollama ëª¨ë¸ ì‚¬ìš©
   from langchain_openai import ChatOpenAI  # vLLM ì„œë²„ ì—°ê²° ì‹œ ì‚¬ìš©
   ```
- **LangGraph í•µì‹¬**
   ```
   from langgraph.graph import StateGraph, END
   ```
   - StateGraph: ìƒíƒœ ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° ê·¸ë˜í”„
   - END: ê·¸ë˜í”„ ì¢…ë£Œ ì§€ì 
- **íƒ€ì… ì •ì˜**
   ```
   from typing import TypedDict, Annotated, Literal
   ```
   - TypedDict: ìƒíƒœ êµ¬ì¡° ì •ì˜
   - Annotated: ìƒíƒœ ì—…ë°ì´íŠ¸ ë°©ì‹ ì§€ì •
   - Literal: ë¼ìš°íŒ… ë°˜í™˜ê°’ ì œí•œ
- **ë©”ì‹œì§€ íƒ€ì…**
   ```
   from langchain_core.messages import HumanMessage, AIMessage, SystemMessage
   ```
- **ìƒíƒœì—°ì‚°ì operator**
   ```
   import operator
   ```
   - operatorì˜ ì—­í• 
      - ì—†ìœ¼ë©´: ë…¸ë“œë§ˆë‹¤ ê°’ ë®ì–´ì“°ê¸°
      - ìˆìœ¼ë©´: ë…¸ë“œë§ˆë‹¤ ê°’ ëˆ„ì 
      - ì˜ˆì‹œ
         ```
         class State(TypedDict):
         messages: Annotated[list, operator.add]  # ëŒ€í™” íˆìŠ¤í† ë¦¬ ìœ ì§€

         # Node 1: ["ì•ˆë…•"]
         # Node 2: ["ë°˜ê°‘ìŠµë‹ˆë‹¤"] 
         # ê²°ê³¼: ["ì•ˆë…•", "ë°˜ê°‘ìŠµë‹ˆë‹¤"]  â† ëˆ„ì ë¨
         ```
   - ì£¼ìš” ì‚¬ìš© íŒ¨í„´:
      ```
      # ë©”ì‹œì§€ ëˆ„ì  (ê°€ì¥ ë§ì´ ì‚¬ìš©)
      messages: Annotated[list, operator.add]

      # ë”•ì…”ë„ˆë¦¬ ë³‘í•©
      data: Annotated[dict, operator.or_]

      # ìˆ«ì/ë¬¸ìì—´ ëˆ„ì 
      count: Annotated[int, operator.add]
      text: Annotated[str, operator.add]
      ```
## ë‹¨ê³„ë³„ í•™ìŠµ
- vllm + ì–‘ìí™” => ì„œë²„ êµ¬ì¶•
- í•„ìš” í™˜ê²½ êµ¬ì¶•
- ë­ê·¸ë˜í”„ í•™ìŠµ
- AI Agent êµ¬í˜„

## 01_ê¸°ì´ˆê°œë…ì„¤ë¦½
### vLLM ê°œë…
- vLLM(Virtual Large Language Model)ì€ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸ì˜ ì¶”ë¡ ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê³ ì„±ëŠ¥ ì„œë¹™ ì—”ì§„
- í•µì‹¬ íŠ¹ì§•
   1. PagedAttention : ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ ë” ë§ì€ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬
   2. ì—°ì† ë°°ì¹˜ ì²˜ë¦¬ : ì—¬ëŸ¬ ìš”ì²­ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ì—¬ ì²˜ë¦¬ëŸ‰ í–¥ìƒ
   3. ìµœì í™”ëœ CUDA ì»¤ë„ : GPU í™œìš©ë„ ê·¹ëŒ€í™”
   4. í˜¸í™˜ì„± : HuggingFace Transformers ì™„ë²½ í˜¸í™˜
- ê¸°ì¡´ ë°©ì‹ vs vLLM
   1. ê¸°ì¡´ ë°©ì‹ : [ìš”ì²­] -> [ì²˜ë¦¬] -> [ì‘ë‹µ] -> [ë‹¤ìŒ ìš”ì²­] -> [ì²˜ë¦¬] -> [ì‘ë‹µ] ...
   2. vLLM : [ìš”ì²­1,2,3...] -> [ë³‘ë ¬ì²˜ë¦¬] -> [ì‘ë‹µ1,2,3,...][ì‘ë‹µ] ...

### ì–‘ìí™” ê°œë…(Quantization)
- ì–‘ìí™”ëŠ” ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë” ì ì€ ë¹„íŠ¸ë¡œ í‘œí˜„í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ ì¶”ë¡  ì†ë„ë¥¼ ê°œì„ í•˜ëŠ” ê¸°ìˆ 
- ì–‘ìí™”ì˜ ì¢…ë¥˜
   1. FP(32) : default, 32ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì 
   2. FP16 : 16ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì (ë©”ëª¨ë¦¬ 50% ì ˆì•½)
   3. INT8 : 8ë¹„íŠ¸ ì •ìˆ˜ (ë©”ëª¨ë¦¬ 75% ì ˆì•½)
   4. INT4 : 4ë¹„íŠ¸ ì •ìˆ˜ (ë©”ëª¨ë¦¬ 87.5% ì ˆì•½)
- ì–‘ìí™” ë°©ë²•
   1. Post-training Quantization : í•™ìŠµ í›„ ì–‘ìí™”(PTQ), ì´ë¯¸ ì™„ì„±ëœ ëª¨ë¸ì„ ì••ì¶•
   2. Quantization-aware Training : í•™ìŠµ ì¤‘ ì–‘ìí™” ê³ ë ¤(QAT), ì²˜ìŒë¶€í„° ì–‘ìí™”ë¥¼ ì—¼ë‘ì— ë‘ê³  í•™ìŠµí•˜ëŠ” ë°©ë²•
- í˜„ì¬ ì‘ì—… í™˜ê²½ : RTX4060 VRAM 8gb, ì‚¬ìš© ì˜ˆì • llmì€ Qwen2.5:7b ëª¨ë¸ë¡œ ì›í™œí•œ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ PTQë¡œ INT8 ì–‘ìí™”(ì˜ˆìƒ í•„ìš” VRAM ~7gb)

### ë­ê·¸ë˜í”„ì˜ ê¸°ë³¸ ê°œë…ì™€ êµ¬ì¡°
#### ë­ê·¸ë˜í”„ì˜ ê¸°ë³¸ ê°œë…
- LangGraphëŠ” ìì—°ì–´ ì²˜ë¦¬(NLP) ê¸°ë°˜ì˜ ì–¸ì–´ **ê·¸ë˜í”„** ì„œë¹„ìŠ¤ í”Œë«í¼
```
   StateGraph: ìƒíƒœë¥¼ ê°€ì§„ ê·¸ë˜í”„. Agentì˜ ë©”ëª¨ë¦¬ ì—­í• 
   Node: ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜. ê° ë‹¨ê³„ë³„ ì²˜ë¦¬ ë‹´ë‹¹
   Edge: Node ê°„ ì—°ê²°. ì‘ì—… íë¦„ ì •ì˜
   State: Agentê°€ ê¸°ì–µí•˜ëŠ” ì •ë³´. ëŒ€í™” ë‚´ìš©, ì¤‘ê°„ ê²°ê³¼ ë“±
   END: ê·¸ë˜í”„ ì¢…ë£Œ ì§€ì 
```
#### ë­ê·¸ë˜í”„ì˜ êµ¬ì¡°
   1. State ì •ì˜ (ë¬´ì—‡ì„ ê¸°ì–µí• ì§€)
   2. Node í•¨ìˆ˜ ì‘ì„± (ê° ë‹¨ê³„ë³„ ì²˜ë¦¬)
   3. Graph êµ¬ì„± (íë¦„ ì„¤ê³„)
   4. ì»´íŒŒì¼ ë° ì‹¤í–‰
   5. ê·¸ë˜í”„ ë¹Œë“œ ìˆœì„œ
   ```
   workflow = StateGraph(CustomerState)  # 1. ê·¸ë˜í”„ ìƒì„±
   workflow.add_node()                   # 2. ë…¸ë“œ ì¶”ê°€
   workflow.set_entry_point()            # 3. ì‹œì‘ì  ì„¤ì •
   workflow.add_conditional_edges()      # 4. ì¡°ê±´ë¶€ ì—£ì§€
   workflow.add_edge()                   # 5. ì¼ë°˜ ì—£ì§€
   app = workflow.compile()              # 6. ì»´íŒŒì¼
   ```

#### **ë­ê·¸ë˜í”„ì˜ ì¡°ê±´ë¶€ ì—£ì§€(Conditional Edge)**
- ì¡°ê±´ë¶€ ì—£ì§€ëŠ” ì…ë ¥ì— ë”°ë¼ ë‹¤ë¥¸ ë…¸ë“œë¡œ ë¶„ê¸°í•˜ëŠ” ê¸°ëŠ¥
- add_conditional_edges() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ ì¶”ê°€
- ë¼ìš°í„°í•¨ìˆ˜ê°€ ì–´ë–¤ ë…¸ë“œë¡œ ê°ˆ ì§€ ê²°ì •
```
1. ì¼ë°˜ ì—£ì§€ vs ì¡°ê±´ë¶€ ì—£ì§€:
   â€¢ ì¼ë°˜ ì—£ì§€: A â†’ B (í•­ìƒ Bë¡œ ì´ë™)
   â€¢ ì¡°ê±´ë¶€ ì—£ì§€: A â†’ B or C or D (ì¡°ê±´ì— ë”°ë¼ ë¶„ê¸°)

2. í•µì‹¬ êµ¬ì„± ìš”ì†Œ:
   â€¢ ë¼ìš°í„° í•¨ìˆ˜: ì–´ë””ë¡œ ê°ˆì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
   â€¢ ë§¤í•‘ ë”•ì…”ë„ˆë¦¬: ë¼ìš°í„° ê²°ê³¼ â†’ ì‹¤ì œ ë…¸ë“œ
   â€¢ ì‹œì‘ ë…¸ë“œ: ì¡°ê±´ë¶€ ë¶„ê¸°ê°€ ì‹œì‘ë˜ëŠ” ë…¸ë“œ

3. ë¬¸ë²• êµ¬ì¡°:
   workflow.add_conditional_edges(
       source="ì‹œì‘_ë…¸ë“œ",
       path=ë¼ìš°í„°_í•¨ìˆ˜, # íŒë³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨. intent classification
       path_map={
           "ì¡°ê±´1": "ë…¸ë“œ1",
           "ì¡°ê±´2": "ë…¸ë“œ2",
           "ì¡°ê±´3": "ë…¸ë“œ3"
       }
   )

```

#### ë­ê·¸ë˜í”„ì˜ ì‹œê°í™”
- ë­ê·¸ë˜í”„ ì‹œê°í™”ëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ë°©ë²•ì´ ìˆìŒ
   1. **Mermaid ë‹¤ì´ì–´ê·¸ë¨** : íŠ¹ì • ì½”ë“œë¥¼ ë°˜í™˜í•˜ë©° ì´ë¥¼ https://mermaid.liveì— ë¶™ì—¬ë„£ê¸° í•˜ë©´ ì‹œê°í™” ê°€ëŠ¥
      ```
      print(app.get_graph().draw_mermaid())
      ```
   2. **PNG ì´ë¯¸ì§€ ì €ì¥** : íŒŒì¼ë¡œ ì €ì¥í•˜ë‚˜ WSLì˜ ê²½ìš° graphbizê°€ í•„ìš”
      ```
      [ì €ì¥ ë°©ì‹]
      png_data = app.get_graph().draw_mermaid_png()
      with open("workflow_graph.png", "wb") as f:
         f.write(png_data)

      [Graphviz ì„¤ì¹˜]
      Linux cmd
         sudo apt-get update
         sudo apt-get install graphviz
      python cmd
         pip install pygraphviz
      ```
   3. ASCII ì•„íŠ¸ : ê°œë°œìê°€ í™•ì¸í•˜ê¸° ìš©ì´í•œ, í„°ë¯¸ë„ì—ì„œ ì¦‰ì‹œ í™•ì¸ì´ ê°€ëŠ¥í•œ ë°©ì‹
      ```
      print(app.get_graph().draw_ascii())
      ```

#### ëŒ€í™” history ì €ì¥ì„ í†µí•œ ë©”ëª¨ë¦¬ agent
- **langchain**ê³¼ ë™ì¼í•˜ê²Œ **langchain.memory.ConversationBufferMemory**ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€í™” ìë™ ì €ì¥
```
# ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
memory.chat_memory.add_user_message(user_message)

# AI ì‘ë‹µ ì €ì¥  
memory.chat_memory.add_ai_message(response)

# ì €ì¥ëœ ëŒ€í™” ë¶ˆëŸ¬ì˜¤ê¸°
memory_content = memory.load_memory_variables({})
```
- **í•µì‹¬ ì¥ì **
```
   1. ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬: ìˆ˜ë™ êµ¬í˜„ ì—†ì´ LangChainì´ ì²˜ë¦¬
   2. í‘œì¤€í™”: LangChain í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ í™œìš©
   3. í™•ì¥ì„±: ë‹¤ë¥¸ LangChain ì»´í¬ë„ŒíŠ¸ì™€ ì‰½ê²Œ ì—°ë™
   4. ì•ˆì •ì„±: ê²€ì¦ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©
```

#### Tool-Using Agent / Function Calling Agent
- LLMì—ê²Œ toolì„ ë¶€ì—¬í•˜ì—¬ ë‹¤ì–‘í•œ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ ìœ ì—°í•œ ë°˜ì‘ì„ ì´ëŒì–´ ë‚¼ ìˆ˜ ìˆìŒ : ê¸°ì¡´ Function Callingì´ë‚˜ langchain.agents.Tool ê°ì²´
- ê·¸ëŸ¬ë‚˜ ë­ê·¸ë˜í”„ì˜ nodeë¥¼ í†µí•´ì„œë„ tool ê¸°ëŠ¥ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŒ => Stateì— ë‹´ì•„ì„œ ì „ë‹¬ í•˜ëŠ” ë“±
- ë‘ ë°©ë²•ì˜ ê°ê°ì˜ ì¥ë‹¨ì 
```
- Langgraph Node ë°©ì‹
- ì˜ˆì‹œ : ì—°êµ¬ Agent(LLM+ê²€ìƒ‰) â†’ ë¶„ì„ Agent(LLM+ê³„ì‚°) â†’ ì‘ê°€ Agent(LLM+ê¸€ì“°ê¸°)
   - ì¥ì : ê° Agentê°€ ì°½ì˜ì  íŒë‹¨
   - ë‹¨ì : ë¦¬ì†ŒìŠ¤ ì†Œëª¨ ë†’ìŒ (LLM í˜¸ì¶œ 9-12íšŒ)

- Langchain.agents.Tool ë°©ì‹
- ì˜ˆì‹œ : ê²€ìƒ‰ í•¨ìˆ˜ â†’ LLM ë¶„ì„ â†’ ê³„ì‚° í•¨ìˆ˜ â†’ LLM ì‘ì„±
   - ì¥ì : ë¦¬ì†ŒìŠ¤ ì†Œëª¨ ì ìŒ (LLM í˜¸ì¶œ 2~3íšŒ ì •ë„) 
   - ë‹¨ì : ìœ ì—°ì„± ë¶€ì¡±
```
- ì´ëŸ° ë‘ ë°©ì‹ì˜ ì¥ì ì„ ê·¹ëŒ€í™”í•˜ëŠ” **í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**ì„ ì„ í˜¸
```
- ì˜ˆì‹œ : ì—°êµ¬ Agent(LLM+ê²€ìƒ‰) â†’ ê³„ì‚° í•¨ìˆ˜ â†’ ì‘ê°€ Agent(LLM+ê¸€ì“°ê¸°)
- ì¥ì : ë¹„ìš© íš¨ìœ¨ + ì ì ˆí•œ ì°½ì˜ì„±
- í•µì‹¬: í•„ìš”í•œ ê³³ì—ë§Œ LLM ì‚¬ìš©
```
- **ì‹¤ë¬´ ê²°ì • ê¸°ì¤€**

- LLM Agentë¥¼ ì“¸ ë•Œ:
```
   - ë³µì¡í•œ íŒë‹¨ì´ í•„ìš”í•  ë•Œ
   - ì°½ì˜ì  ì‘ì—…ì¼ ë•Œ
   - ì‚¬ìš©ì ì˜ë„ íŒŒì•…ì´ ì¤‘ìš”í•  ë•Œ
```

- í•¨ìˆ˜ ë…¸ë“œë¥¼ ì“¸ ë•Œ:
```
   - ì •í•´ì§„ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥í•  ë•Œ
   - ì†ë„ê°€ ì¤‘ìš”í•  ë•Œ
   - ë¹„ìš©ì„ ì ˆì•½í•˜ê³  ì‹¶ì„ ë•Œ
```
##### create_react_agent ë¡œ Agent ìƒì„±í•˜ê¸°
```
from langgraph.prebuilt import create_react_agent
```
- ìœ„ ì½”ë“œ í•œì¤„ê³¼ toolì„ ì‚¬ìš©í•´ ë§Œë“  íˆ´ë°•ìŠ¤ë¡œ AIê°€ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ì—¬ ë‹µë³€í•  ìˆ˜ ìˆë„ë¡ ìœ ë„ê°€ ê°€ëŠ¥í•˜ë‹¤.
- @tool ì–´ë…¸í…Œì´ì…˜ ì•„ë˜ì— í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  return ê°’ì„ strë¡œ ë°”ê¿”
- tools = [tool1, tool2,...] ë¡œ ë„êµ¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê³ 
- create_react_agent(llm : ChatOllama, tools) ë¡œ Agent ìƒì„±í•˜ë©´ ë
- ë¬¸ì œëŠ” Function Calling ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë„êµ¬ ì§€ì› ëª¨ë¸ì´ í•„ìš” 
   => ë³´í†µ íŒŒì¸ íŠœë‹ ì‹œ ê°™ì´ í•™ìŠµí•˜ì§€ ì•Šìœ¼ë©´ Catastrophic Forgetting (íŒŒêµ­ì  ë§ê°) ìƒíƒœë¡œ ì‚¬ìš© ë¶ˆëŠ¥
- í•œêµ­ì–´ Agentë¥¼ ë§Œë“œë ¤ë©´ 1. í‘ì…˜ ì½œë§ ê°€ëŠ¥ ëª¨ë¸ì˜ ë‹µë³€ 2. ë²ˆì—­ ë“±ì˜ í˜•íƒœë¡œ ì‚¬ìš©í•˜ê±°ë‚˜
- ì• ì´ˆì— íŒŒì¸ íŠœë‹ ì‹œ í‘ì…˜ ì½œë§ì„ ê³ ë ¤í•´ ì„¤ê³„í•´ì•¼í•¨

#### ë„êµ¬ ì‚¬ìš© Agent ìƒì„± ë°©ì‹
1. ìˆ˜ë™ ë…¸ë“œ êµ¬í˜„: LLMì´ í…ìŠ¤íŠ¸ë¡œ ë„êµ¬ í˜¸ì¶œ â†’ íŒŒì‹± â†’ ì‹¤í–‰
2. bind_tools + ìˆ˜ë™ ê·¸ë˜í”„: LLMì´ tool_calls ìƒì„± â†’ ToolNode ìë™ ì‹¤í–‰
3. create_react_agent: ëª¨ë“  ê³¼ì • ìë™í™” (bind_tools + ê·¸ë˜í”„ êµ¬ì„±)
- ì´ì™¸ì—ë„ ì—¬ëŸ¬ ë°©ì‹ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í‘ì…˜ ì½œë§ì´ ê°€ëŠ¥í•  ë•Œ 3ë²ˆ create_react_agent ë°©ì‹ì´ ê°€ì¥ ë¹ ë¥´ê²Œ ë°˜ì‘í•¨
- langchain.agents.initialize_agent ë°©ì‹ìœ¼ë¡œë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê¸´ í•œë° ëª¹ì‹œ ëŠë ¸ìŒ => ë ˆê±°ì‹œ ëª¨ë¸
- ê·¸ëŸ¬ë‚˜ íŒŒì¸íŠœë‹ ëœ ëª¨ë¸ì„ í™œìš©í•´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê²Œ í•  ë•ŒëŠ” ì•„ì§ê¹Œì§€ë„ initialize_agentì´ ê°€ì¥ íš¨ìœ¨ì ì´ë¼ê³  ì‚¬ë£Œë¨
- í˜¹ì€ ìˆ˜ë™ ë…¸ë“œ êµ¬í˜„ì„ í†µí•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì„ ë“¯ (ì˜ˆì‹œ : tools íŒë‹¨ -> query ê¹Œì§€ ì¶”ë¡  => ìœ„ ë‚´ìš©ì„ í•¨ìˆ˜ ë…¸ë“œë¡œ ì „ë‹¬ í›„ State ìµœì‹ í™” ë“±)

#### ì²´í¬í¬ì¸íŠ¸ & ìƒíƒœ ì €ì¥
**[ì²´í¬í¬ì¸íŠ¸ì˜ ì˜ì˜]**
- ì²´í¬í¬ì¸íŠ¸ëŠ” ì„œë²„ ì¬ì‹œì‘ ì‹œ ëŒ€í™” ì´ì–´ê°€ê¸°
- ê¸´ ì‘ì—… ì¤‘ë‹¨ í›„ ë‚˜ì¤‘ì— ì¬ê°œ
- ì‚¬ìš©ìë³„ ì„¸ì…˜ê´€ë¦¬ 

##### [ì‚¬ìš© ë°©ì‹]

**[ì €ì¥]**
```
workflow = StateGraph(State:TypedDict)
....
memory = MemorySaver()
app = workflow.compile(checkpointer=memory)
```

**[ì €ì¥ ìƒíƒœ ì¡°íšŒ]**
```
snapshot = app.get_state(config)

print("=== ì €ì¥ëœ ë°ì´í„° ===")
print(f"í˜„ì¬ ìƒíƒœ: {snapshot.values}")
print(f"ë‹¤ìŒ ë…¸ë“œ: {snapshot.next}")
print(f"ì²´í¬í¬ì¸íŠ¸ ID: {snapshot.config['configurable']['checkpoint_id']}")
```

**[ì „ì²´ íˆìŠ¤í† ë¦¬ ì¡°íšŒ]**
```
print("\n=== ì „ì²´ ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ===")
for i, state in enumerate(app.get_state_history(config)):
    print(f"\n[{i}] ì²´í¬í¬ì¸íŠ¸: {state.config['configurable']['checkpoint_id'][:8]}")
    print(f"    ìƒíƒœ: category={state.values.get('category')}, response={state.values.get('response')[:30] if state.values.get('response') else 'None'}...")
```
</br>
ì•„ë˜ í™œìš© ì˜ˆì‹œ

- [ë¡¤ë°±] 2ë‹¨ê³„ ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°
   ```
   app.update_state(config, values=None, as_node="classifier")
   ```
- [ë””ë²„ê¹…] ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ ì¶”ì 
   ```
   for state in app.get_state_history(config):
      print(state.values)
   ```
- [ì‘ì—… ì¬ê°œ] ì„œë²„ ì¬ì‹œì‘ í›„ì—ë„ ê°™ì€ ì§€ì ë¶€í„° ì´ì–´ì„œ
   ```
      snapshot = app.get_state(config)
      app.invoke(None, config=config)  # ì´ì–´ì„œ ì‹¤í–‰
   ```



#### ë©€í‹° ì—ì´ì „íŠ¸
- LLM -> LLM ì—°ê²°ë¡œ ë³´ë‹¤ ìœ ì—°í•˜ê³  ê°•ë ¥í•œ ì—ì´ì „íŠ¸ êµ°ì§‘ì„ ìƒì„±í•  ìˆ˜ ìˆìŒ.
- ìƒì„± ë°©ë²•ì€ ë‹¨ìˆœí•˜ê²Œ Nodeì—ì„œ Stateë¥¼ ì²´í¬í•˜ê³  í•¨ìˆ˜ ê¸°ëŠ¥ì„ ì‘ë™í•˜ì—¬ LLMì˜ ì¶”ë¡ ì´ í•„ìš”í•œ Nodeì— invokeí•˜ì—¬ ê²°ê³¼ë¥¼ ìœ ë„í•˜ëŠ” ë°©ì‹
- ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ
```
    ì‚¬ìš©ì ìš”ì²­
         â†“
    ğŸ¤– ì—°êµ¬ì Agent (LLM)
    â”œâ”€ ê²€ìƒ‰ í•„ìš”ì„± íŒë‹¨
    â”œâ”€ ê²€ìƒ‰ ì‹¤í–‰
    â””â”€ ë°ì´í„° ìˆ˜ì§‘
         â†“
    âš™ï¸ ë¶„ì„ ë…¸ë“œ (í•¨ìˆ˜)
    â”œâ”€ í…ìŠ¤íŠ¸ ë¶„ì„
    â”œâ”€ í‚¤ì›Œë“œ ì¶”ì¶œ
    â””â”€ í†µê³„ ê³„ì‚°
         â†“
    âœï¸ ì‘ê°€ Agent (LLM)
    â”œâ”€ ì¢…í•© ë¶„ì„
    â”œâ”€ ì½˜í…ì¸  ì‘ì„±
    â””â”€ êµ¬ì¡°í™”
         â†“
    ğŸ“‹ ì •ë¦¬ ë…¸ë“œ (í•¨ìˆ˜)
    â”œâ”€ í¬ë§·íŒ…
    â”œâ”€ ë©”íƒ€ë°ì´í„° ì¶”ê°€
    â””â”€ ìµœì¢… ì¶œë ¥
         â†“
    âœ… ì™„ë£Œëœ ê²°ê³¼
```
- ë‹¤ë§Œ, LLM ì¶”ë¡  ì‹œê°„ì´ ê³¼ì •ë§ˆë‹¤ ë°œìƒí•˜ê³  í™œìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì–‘ì´ ë§ì•„ì§€ëŠ” ë“± ì‹œê°„ì , ê²½ì œì , ë¬¼ë¦¬ì  í•œê³„ê°€ ë°œìƒ ê°€ëŠ¥

## 02_ì‹¬í™”ê¸°ëŠ¥
### 01_ì‹¤ìŠµ_ê³ ê°ë¬¸ì˜ì²˜ë¦¬ì‹œìŠ¤í…œ.py ì•„í‚¤íƒì³ ë° ì‹¤í–‰ íë¦„ ì˜ˆì‹œ
```
[ì•„í‚¤íƒì³]
   [ìµœì´ˆ]

      [START]
         â†“
      [ë¶„ë¥˜ ì—ì´ì „íŠ¸] â†’ category ê²°ì •
         â†“
      [ì¡°ê±´ë¶€ ë¼ìš°íŒ…]
         â”œâ”€ technical â†’ [ê¸°ìˆ ì§€ì› ì—ì´ì „íŠ¸]
         â”œâ”€ billing   â†’ [ê²°ì œ ì—ì´ì „íŠ¸]
         â””â”€ general   â†’ [ì¼ë°˜ ì—ì´ì „íŠ¸]
         â†“
      [END]
   
   [ê²°ê³¼ë¬¼ì— ë”°ë¼ retry ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •]
      retry â†’ route_query â†’ [tech/billing/general] â†’ check_confidence
            â†‘_______________retry________________|

[ì‹¤í–‰íë¦„ ì˜ˆì‹œ]
   [ì…ë ¥]
   state = {
      "query": "ê²°ì œê°€ ì•ˆë¼ìš”",
      "category": "",
      "response": "",
      "confidence": 0.0
   }

   [ì‹¤í–‰ ìˆœì„œ]
   1. classifier â†’ category = "billing"
   2. route_query â†’ "billing" ë°˜í™˜
   3. billing_agent â†’ response = "ê²°ì œ ë¬¸ì œ í•´ê²° ë°©ë²•..."
   4. LLMì— ì˜í•œ Confidence ê²°ì •
   5. Confidenceì— ë”°ë¥¸ ì¡°ê±´ë¶€ ë¼ìš°íŒ…(0.7 ê¸°ì¤€ ì„±ê³µ/ì‹¤íŒ¨, 2ì°¨ë¡€ ì‹¤íŒ¨ì‹œ ìƒë‹´ì› ì—°ê²°ì˜ êµ¬ì¡° ìœ ë„)
      [ì„±ê³µ ì¼€ì´ìŠ¤]
      classifier â†’ tech_support (0.85) â†’ END

      [ì¬ì‹œë„ ì¼€ì´ìŠ¤]
      classifier â†’ tech_support (0.55) â†’ retry â†’ tech_support (0.78) â†’ END

      [ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì¼€ì´ìŠ¤]
      classifier â†’ tech_support (0.50) â†’ retry â†’ tech_support (0.52) â†’ retry â†’ tech_support (0.48) â†’ escalate â†’ END
   6. END
```
### íœ´ë¨¼ ì¸ ë” ë£¨í”„
- íœ´ë¨¼ ì¸ ë” ë£¨í”„ ë°©ì‹ì€ ì¤‘ìš” ì˜ì‚¬ ê²°ì • ì‚¬í•­ì—ì„œ ì¸ê°„ì˜ íŒë‹¨ì´ ê°œì…ë˜ëŠ” êµ¬ì¡°
- **ì²´í¬í¬ì¸íŠ¸ì˜ í•µì‹¬ í™œìš© ì‚¬ë¡€**
   - **[ì‹¤í–‰íë¦„]**
   ```
   1. draft â†’ AI ì´ˆì•ˆ ì‘ì„±
   2. interrupt_before ì„ íƒí•œ ë…¸ë“œ ì „ INTERRUPT
   3. [ì‚¬ëŒ ê°œì…] ìŠ¹ì¸ or ìˆ˜ì • ìš”ì²­
   4. update_stateë¡œ ê²°ì • ë°˜ì˜
   5. invoke(None) â†’ ì¬ê°œ
   6. final â†’ ìµœì¢… ì‘ë‹µ
   7. END
   ```

### ë³µì¡í•œë©€í‹°ì—ì´ì „íŠ¸_ê´€ë¦¬ìì™€ì‹¤ë¬´ìì‹œì 
- **Manager ì—ì´ì „íŠ¸ê°€ ì—¬ëŸ¬ Worker ì—ì´ì „íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°**
   ```
   [ê³„ì¸µêµ¬ì¡°]
   Manager (ê´€ë¦¬ì)
   â”œâ”€ Researcher (ì¡°ì‚¬)
   â”œâ”€ Analyzer (ë¶„ì„)
   â””â”€ Writer (ì‘ì„±)

   [ìˆœí™˜ íë¦„]
   Manager â†’ Researcher â†’ Manager â†’ Analyzer â†’ Manager â†’ Writer â†’ END
   ```
- Stateë¥¼ í™•ì¸í•´ì„œ ì¡°ê±´ ë¶„ê¸°ë¡œ ì§„í–‰í•  ìˆ˜ë„ ìˆê³  LLMì˜ íŒë‹¨ì— ì˜ê±°í•˜ì—¬ ì›Œì»¤ë¥¼ ê²°ì •í•  ìˆ˜ë„ ìˆìŒ
- ë˜í•œ ë…¸ë“œë¥¼ ì´ì–´ì„œ ë³‘ë ¬ Worker ì‹¤í–‰ìœ¼ë¡œ íš¨ìœ¨ì„±ì„ ì¶”êµ¬í•  ìˆ˜ë„ ìˆìŒ
- ì˜ˆì‹œ í˜•íƒœ
   ```
   # ë™ì  Worker ì„ íƒ
   def manager_node(state):
    '''LLMì´ ì–´ë–¤ Workerê°€ í•„ìš”í•œì§€ ê²°ì •'''
    prompt = f"ì£¼ì œ: {state['topic']}\në‹¤ìŒ ì¤‘ í•„ìš”í•œ ì—­í• ì€? researcher/analyzer/writer"
    decision = llm.invoke([HumanMessage(content=prompt)])
    return {"current_worker": decision.content.strip()}

   # ë³‘ë ¬ Worker ì‹¤í–‰
   # ì—¬ëŸ¬ Researcherê°€ ë™ì‹œì— ë‹¤ë¥¸ ì†ŒìŠ¤ ì¡°ì‚¬
   workflow.set_entry_point("manager")

   workflow.add_edge("manager", "researcher_web")
   workflow.add_edge("manager", "researcher_db")
   workflow.add_edge("manager", "researcher_api")

              [Agent]
                 â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
         â†“       â†“       â†“
      [Web]   [DB]   [API]  â† ë³‘ë ¬ ì‹¤í–‰
         â†“       â†“       â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
            [Aggregate]
                 â†“
               [END]
   ```
- ë§ì€ ê°€ëŠ¥ì„±ì„ ê°–ê³  ìˆëŠ” êµ¬ì¡°

## ì‹¬í™”í•™ìŠµ ê°€ëŠ¥ ë‚´ìš©
   1. ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬
      - ì„œë¸Œê·¸ë˜í”„ (Subgraph): í° ê·¸ë˜í”„ ì•ˆì— ì‘ì€ ê·¸ë˜í”„ ë„£ê¸°
         ```
         sub_workflow = StateGraph(SubState)
         # ... ì„œë¸Œê·¸ë˜í”„ ì •ì˜
         
         main_workflow.add_node("sub_task", sub_workflow.compile())
         ```
      - ë³‘ë ¬ ìƒíƒœ ì—…ë°ì´íŠ¸: ì—¬ëŸ¬ ë…¸ë“œê°€ ë™ì‹œì— ë‹¤ë¥¸ ìƒíƒœ í•„ë“œ ìˆ˜ì •

   2. ì‹¤ì „ íŒ¨í„´
      - Plan-and-Execute íŒ¨í„´: ê³„íš ìˆ˜ë¦½ â†’ ë‹¨ê³„ë³„ ì‹¤í–‰ â†’ ê²€ì¦
         ```
         Planner â†’ Executor â†’ Validator â†’ (ì¬ê³„íš or ì™„ë£Œ)
         ```
      - Self-Correction íŒ¨í„´: ì—ì´ì „íŠ¸ê°€ ìê¸° ì¶œë ¥ì„ ê²€ì¦í•˜ê³  ìˆ˜ì •
         ```
         Generator â†’ Critic â†’ Reviser â†’ (ì¬ê²€ì¦ or ì™„ë£Œ)
         ```
      - Memory-Enhanced Agent: ì¥ê¸° ë©”ëª¨ë¦¬ + ë‹¨ê¸° ë©”ëª¨ë¦¬ ê²°í•©

   3. í”„ë¡œë•ì…˜ ì¤€ë¹„
      - ë¹„ë™ê¸° ì²˜ë¦¬ (Async): FastAPIì™€ í†µí•©
        ```
         async def agent_node(state):
         result = await llm.ainvoke(messages)
        ```
      - ì—ëŸ¬ ë³µêµ¬ ì „ëµ: ì¬ì‹œë„, í´ë°±, Circuit Breaker
      - ëª¨ë‹ˆí„°ë§: LangSmith ì—°ë™, ë¡œê¹…, ì„±ëŠ¥ ì¶”ì 
      - ë°°í¬: Docker, Kubernetes, í´ë¼ìš°ë“œ ì„œë¹™
      
   4. ë„ë©”ì¸ íŠ¹í™”
      - RAG Agent: ë¬¸ì„œ ê²€ìƒ‰ + ë‹µë³€ ìƒì„±
      - ì½”ë“œ ìƒì„± Agent: ì½”ë”© ì–´ì‹œìŠ¤í„´íŠ¸
      - ë°ì´í„° ë¶„ì„ Agent: CSV/DB ë¶„ì„ ìë™í™”
      - ë©€í‹°ëª¨ë‹¬ Agent: ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ ì²˜ë¦¬